library(tidyverse)
library(RColorBrewer)

rm(list=ls())
vp <- read.csv("adaptive_Vs_neutral/variance_partition.csv",header=T)
vp

vp <- vp %>% 
  mutate(joint=total-env_only-ps_only) %>% 
  dplyr::select(species, ps_only, env_only, joint, total)
vp

vp_long <- vp %>% 
  gather(source, variance, ps_only:total, factor_key = TRUE)

p <- vp_long %>% 
  ggplot()+
  geom_bar(aes(x=species, y=variance*100, fill=factor(source)), colour="black",stat="identity", position=position_dodge())+
  theme_classic(base_size = 15)+
  scale_y_continuous(expand = c(0,0), limits=c(0, 35)) +
  ylab("Percentage of adaptive genetic variance explained")+
  theme(axis.title.x=element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x = element_text(size=15),
        legend.position = c(0.75,0.8),
        legend.title = element_blank(),
        #legend.direction = "horizontal",
        legend.text = element_text(size=15),
        legend.background = element_rect(colour="black"),
        #legend.key = element_rect(size=8, color='white'),
        legend.key.size = unit(1.5, 'lines')
        ) +
  scale_fill_brewer(palette = "Blues",name="source", labels=c("Population structure only", "Environment only", "Collinearity", "Total"))
  
pdf("adaptive_Vs_neutral/varpart.pdf")
p
dev.off()
        